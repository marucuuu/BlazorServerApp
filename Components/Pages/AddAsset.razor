@page "/addasset"
@inject AssetService AssetService
@inject UserService UserService
@inject NavigationManager Navigation

@using BlazorServerApp.Models;

@using BlazorServerApp.Data;

@using Microsoft.EntityFrameworkCore;

<PageTitle>Add Asset</PageTitle>

<h3 class="mb-4">Add Asset for Employees</h3>

<EditForm Model="@asset" OnValidSubmit="HandleValidSubmit" FormName="AddAssetForm">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group mb-3">
        <label>Employee Name</label>
        <InputSelect class="form-control" @bind-Value="asset.EmployeeName">
            <option value="">-- Select Employee --</option>
            @if (users != null)
            {
                @foreach (var user in users)
                {
                    <option value="@($"{user.FirstName} {user.LastName}")">
                        @($"{user.FirstName} {user.LastName}")
                    </option>
                }
            }
        </InputSelect>
        <ValidationMessage For="@(() => asset.EmployeeName)" />
    </div>

    <div class="form-group mb-3">
        <label>Department</label>
        <InputText class="form-control" @bind-Value="asset.Department" />
        <ValidationMessage For="@(() => asset.Department)" />
    </div>

    <div class="form-group mb-3">
        <label>Sub Unit</label>
        <InputText class="form-control" @bind-Value="asset.SubUnit" />
        <ValidationMessage For="@(() => asset.SubUnit)" />
    </div>

    <div class="form-group mb-3">
        <label>Asset Type</label>
        <InputSelect class="form-control" TValue="string" @bind-Value="asset.AssetType">
            <option value="">-- Select Asset Type --</option>
            <option>Laptop</option>
            <option>Monitor</option>
            <option>Keyboard</option>
            <option>Mouse</option>
            <option>Phone</option>
        </InputSelect>
        <ValidationMessage For="@(() => asset.AssetType)" />
    </div>

    <div class="form-group mb-3">
        <label>Serial Number</label>
        <InputText class="form-control" @bind-Value="asset.SerialNumber" />
        <ValidationMessage For="@(() => asset.SerialNumber)" />
    </div>

    <div class="form-group mb-3">
        <label>Asset Condition</label>
        <InputSelect class="form-control" TValue="string" @bind-Value="asset.AssetCondition">
            <option value="">-- Select Condition --</option>
            <option>New</option>
            <option>Good</option>
            <option>Used</option>
            <option>Damaged</option>
        </InputSelect>
        <ValidationMessage For="@(() => asset.AssetCondition)" />
    </div>

    <button type="submit" class="btn btn-primary">Add Asset</button>
</EditForm>

@code {
    private List<Users>? users;
    [Parameter]
    [SupplyParameterFromForm]
    public AssetsQR asset { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        users = await UserService.GetAllUsersAsync();
    }

    private async Task HandleValidSubmit()
    {
        await AssetService.AddAssetAsync(asset);
        asset = new AssetsQR();

        Navigation.NavigateTo("/viewaddedasset");
    }
}
